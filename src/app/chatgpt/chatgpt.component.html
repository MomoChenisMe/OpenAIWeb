<div class="flex items-center justify-center min-h-screen">
  <!-- Hamburger 選單 -->
  <app-slider-menu [showHamburgerSize]="1024">
    <div class="mt-4 p-1 flex flex-col w-full">
      <ng-container *ngTemplateOutlet="chatroomListTemplate"></ng-container>
    </div>
  </app-slider-menu>
  <div class="absolute inset-0 flex items-center justify-center mt-16">
    <div class="w-full h-full p-4 flex flex-col items-center justify-center">
      <div class="flex flex-col bg-gray-800 rounded-lg shadow-lg w-full h-full overflow-hidden">
        <div class="text-3xl font-bold text-white p-3 flex items-center">
          <ng-icon class="text-lime-300 mr-3" size="2rem" name="matForumRound"></ng-icon>
          <span>ChatGPT 3.5</span>
        </div>
        <div class="flex flex-row w-full h-full overflow-hidden border-t border-gray-700">
          <div class="flex-none max-lg:hidden w-60 border-r border-gray-700 p-4 flex flex-col">
            <ng-container *ngTemplateOutlet="chatroomListTemplate"></ng-container>
          </div>
          <div class="relative flex-1 p-4 flex flex-col w-full">
            <button *ngIf="scrollButton$ | async" (click)="onScrollToBottomClick()"
              class="absolute bottom-28 right-10 z-10 rounded-full bg-gray-500 hover:bg-gray-600 active:bg-gray-400 text-white flex items-center p-1 shadow-lg">
              <ng-icon size="1.25rem" name="matArrowDownwardRound"></ng-icon></button>
            <div #chatGPTContentDiv (scroll)="onChatGPTContentScroll($event)"
              class="relative flex-1 overflow-y-auto h-full border border-gray-700 rounded-md p-2 flex flex-col-reverse"
              style="scroll-behavior: smooth">
              <div class="flex flex-col space-y-6">
                <ng-container
                  *ngIf="!currentCharRoomContent || currentCharRoomContent.length === 0; else chatroomContentTemplate">
                  <div class="absolute inset-0 m-auto p-4 flex flex-col items-center justify-center text-white">
                    <div class="text-3xl font-bold">歡迎使用</div>
                    <div class="text-3xl font-bold">ChatGPT 3.5</div>
                    <div class="mt-5 flex flex-row space-x-20">
                      <div class="flex flex-col flex-1 items-center text-blue-300">
                        <ng-icon size="3.25rem" name="matLightModeRound"></ng-icon>
                        <span>範例</span>
                        <button class="my-4 bg-gray-500 hover:bg-gray-600 rounded-lg px-4 py-2 flex items-center"
                          (click)="onExampleClick('給我Delphi List範例')">
                          "給我Delphi List範例"<ng-icon class="ml-1" size="1rem" name="matArrowRightAltRound"></ng-icon>
                        </button>
                        <button class="my-4 bg-gray-500 hover:bg-gray-600 rounded-lg px-4 py-2 flex items-center"
                          (click)="onExampleClick('示範MSSQL的LEFT JOIN')">
                          "示範MSSQL的LEFT JOIN"<ng-icon class="ml-1" size="1rem" name="matArrowRightAltRound"></ng-icon>
                        </button>
                      </div>
                      <div class="flex flex-col flex-1 items-center text-yellow-400">
                        <ng-icon size="3.25rem" name="matBoltRound"></ng-icon>
                        <span>功能</span>
                        <div class="my-4 bg-gray-500 rounded-lg px-4 py-2">
                          使用ChatGPT3.5 Turbo
                        </div>
                        <div class="my-4 bg-gray-500 rounded-lg px-4 py-2">
                          目前限制約4096字元以內的對話記錄
                        </div>
                        <div class="my-4 bg-gray-500 rounded-lg px-4 py-2">
                          未來開放: GPT4
                        </div>
                      </div>
                      <div class="flex flex-col flex-1 items-center text-red-300">
                        <ng-icon size="3.25rem" name="matSentimentNeutralRound"></ng-icon>
                        <span>限制</span>
                        <div class="my-4 bg-gray-500 rounded-lg px-4 py-2">
                          注意!目前3.5版本偶爾會產生不正確的資訊
                        </div>
                        <div class="my-4 bg-gray-500 rounded-lg px-4 py-2">
                          3.5版本準確度不高,請謹慎使用
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
                <ng-template #chatroomContentTemplate>
                  <ng-container *ngFor="let item of currentCharRoomContent; index as i">
                    <div class="flex flex-row items-start justify-start self-end"
                      *ngIf="item.role === 'user' && item.content !== ''">
                      <!-- User頭像 -->
                      <img *ngIf="!UserPicture || UserPicture === ''"
                        class="flex-none w-8 h-8 rounded-full bg-gray-50 mr-3 flex items-center justify-center text-blue-500 text-lg font-bold"
                        src="assets/User-Avatar.svg">
                      <img *ngIf="UserPicture && UserPicture !== ''"
                        class="flex-none w-8 h-8 bg-gray-50 p-1 rounded-full mr-3 flex items-center justify-center"
                        [src]="UserPicture">
                      <!-- User對話框 -->
                      <div
                        class="flex-1 bg-blue-600 rounded-xl px-3 py-2 text-white lg:max-w-xl md:max-w-xl sm:max-w-lg xs:max-w-xs xxs:max-w-xxs">
                        {{ item.content }}
                      </div>
                    </div>
                    <div class="flex flex-row items-start justify-start self-start"
                      *ngIf="item.role === 'assistant' && item.content !== ''">
                      <!-- AI頭像 -->
                      <img class="flex-none w-8 h-8 rounded-full bg-purple-50 mr-3 flex items-center justify-center"
                        src="assets/AI-Avatar.svg">
                      <!-- AI對話框 -->
                      <div
                        class="flex-1 flex flex-col xl:max-w-4xl lg:max-w-xl md:max-w-xl sm:max-w-lg xs:max-w-xs xxs:max-w-xxs">
                        <div class="bg-purple-600 rounded-xl px-3 py-2 text-white">
                          <markdown class="prose prose-default text-white" lineNumbers ngPreserveWhitespaces
                            [data]="item.content">
                          </markdown>
                        </div>
                      </div>
                    </div>
                  </ng-container>
                </ng-template>
              </div>
            </div>
            <form [formGroup]="chatGPTForm" class="flex-none relative flex items-center mt-4">
              <input
                class="bg-gray-900 border border-blue-600 rounded-md p-3 flex-1 text-white focus:outline-none focus:border-blue-400 appearance-none"
                type="text" placeholder="輸入訊息..." formControlName="content" />
              <button *ngIf="!(loading$ | async)"
                class="absolute right-1 bg-gray-900 hover:bg-gray-700 text-white p-2 rounded hover:shadow-lg flex items-center"
                type="submit" (click)="onMessageSendClick()" [disabled]="(loading$ | async)">
                <ng-icon size="1.25rem" name="matSendRound"></ng-icon>
              </button>
              <span class="loader absolute right-3 p-2" *ngIf="(loading$ | async)"></span>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Logo -->
  <app-logo cssClass="absolute top-4 left-20 max-lg:left-36 h-10 w-24"></app-logo>
  <!-- User -->
  <app-user></app-user>
</div>



<ng-template #chatroomListTemplate>
  <button class="flex items-center justify-center text-gray-400 hover:text-white w-full border
  border-gray-400 hover:border-purple-500 p-2 rounded-lg mb-4" (click)="onNewChatClick()"
    [disabled]="(loading$ | async)">
    <ng-icon size="1.25rem" name="matAddRound"></ng-icon>
    <span>新增聊天室</span>
  </button>
  <ng-container *ngFor="let item of chatRoomData">
    <ng-container *ngIf="item.chatroomID !== ''">
      <app-chatroom-button [chatroom]="item" [currentChatroomID]="currentChatRoomID"
        (chatroomClick)="onChatroomClick($event)" (chatroomDeleteClick)="onChatroomDeleteClick($event)"
        (chatroomEditSaveClick)="onChatroomEditSaveClick()" [chatDisabled]="(loading$ | async)"></app-chatroom-button>
    </ng-container>
  </ng-container>
</ng-template>
